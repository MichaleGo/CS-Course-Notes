第5章   文件系统
1	什么是文件和文件系统? 文件系统的主要功能。UNIX系统如何对文件进行分类？它有什么好处？
文件是存储在外部存储器上的具有符号名的相关信息的集合。包括文件控制块、文件体两部分。
文件系统是OS中管理文件的软件机构，包括管理文件所需的数据结构、相应的管理软件和被管理的文件。。由一组文件和一个文件目录结构组成。
主要功能：
1）管理文件存储器。记录空间使用情况，分配空间，调整或回收空间。
2）实现按名存取。利用目录结构快速定位文件。
3）应具有灵活多样的文件结构和存取方法，便于用户存储和加工处理信息。
4）提供一套使用方便、简单的操作命令。
5）保证文件信息的安全性。
6）便于文件的共享。
UNIX系统中的文件分类：
(1)普通文件：通常的文件。
(2)目录文件：由文件目录构成的一类用来维护文件系统结构的文件。对其处理同普通文件。
(3)特别文件：输入设备和输出设备（字符型特别文件），输入/输出型设备（块特别文件），管道文件。
2	文件目录的作用是什么?文件目录项通常包含哪些内容? 文件控制块。
引入文件系统的主要目的是使用户实现按名存取文件。
文件目录指记录文件的名字机器存放物理地址的一张映射表，表中包括了许多文件控制块（FCB），文件名，第一个物理块号等其他管理控制信息。
3	文件的逻辑结构有几种形式？文件的存取方法？
文件的逻辑结构：1）无结构的字节流式文件。由无结构的先后到达的相关字节组成，其文件长度就是所包含的字节个数。
2）有结构的记录式文件。分为定长记录式文件和变长记录式文件。
文件的存取方法：（1）顺序存取：按照文件信息的逻辑顺序依次存取。是在前一次存取的基础上进行的。
（2）直接存取（随机存取）：基于文件的磁盘模型，磁盘允许对任意文件块进行随机读和写。对记录式文件而言。根据记录的编号来直接存取文件中的任意一个记录。对字节流文件而言。根据系统调用命令把读/写指针调整到欲读/写位置上，然后读/写指定字节数的信息

目录结构：一级、二级、多级
4	文件的物理结构有几种组织形式?对于不同的组织形式，文件系统是如何进行管理的?
1）连续文件（顺序文件） 文件内容连续存放。优点简单。支持顺序存取和随机存取。存取速度快。只要访问一次文件的管理信息，就可方便地存取到任一记录。缺点：不灵活，容易产生碎片。连续结构适合存储长度不变的系统文件。
2）链接文件 不要求文件内容连续存放。把文件所占用的物理块用链接指针链接起来。优点：可以解决外存的碎片问题，提高了外存空间的利用率；允许文件动态增长。 缺点：只能按文件的指针链顺序存取，查找效率较低。索引表又叫做文件映射表可以克服链接文件不能随机存取的缺点
3）索引文件 为每个文件建立一张索引表。用索引表记录文件内容的存放地址，即记录文件的逻辑块号和对应的物理块号之间的关系。Unix和Linux的Ext2采用多级索引结构。优点：文件可动态修改；随机、顺序存取。缺点：索引表的使用增加了存储空间的开销；降低了文件的存取速度。
 4）索引顺序文件 Windows的NTFS文件系统，MFT主控文件表，采用静态索引结构。
5	DOS文件卷的结构，DOS系统的文件物理组织是什么？
MS-DOS就是使用文件分配表（FAT）来分配和管理磁盘空间的。DOS系统的文件采用链接结构。（索引顺序文件）
6	为什么要进行记录的组块和分解？
实际一个逻辑记录与物理块的大小是不相等的。当用户文件的逻辑记录远小于物理块大小时，一个逻辑记录存放在一个物理块总，将会造成极大的浪费。为此，可把多个逻辑记录存放在一个物理块中，也允许一个逻辑记录跨块存放。这样可以提高存储器的利用率。
7	文件存储空间的管理方法有几种?它们各是如何实现文件存储空间的分配和回收的?
空白文件目录 （是一种最简单的方法）空白文件是一个连续未用的空闲盘块区。系统为所有这些空白文件建立一张表。每个空白文件占用一个表目。适合于文件的静态分配（连续文件的分配）。
 空闲块链表 
（1）空闲块链 把所有空闲块连接成一个链表。优点：简单。适合文件动态分配。缺点：工作效率低。分配和回收多个盘块时要多次访问磁盘才能完成。
（2）空闲块成组链表
便于空闲块的分配与回收。适合连续文件、链接文件和索引文件的存储分配。
位映像表(bit map)或位示图 
是适合文件静态分配和动态分配的最简单方法。每一个二进制位对应一个物理盘块。为1时表示块已分配，为0时空闲。优点：易找到一个或几个连续的空闲块。其尺寸固定，可以保存在主存，便于分配和回收空间。
8	建立多级目录有哪些好处?文件的重名和共享问题是如何得到解决的?
多级目录优点：层次结构清晰，便于管理和保护；有利于文件分类；解决重名问题；提高文件检索速度；能够控制存取权限。
文件名包含了从根目录开始的路径，因此只要在同一个目录下面不存在相同的文件名，系统就不会有文件重名。
只需要将各用户文件目录中的一个目录项指向同一个文件的存放地址，则各个用户都可以存取该文件，实现了共享。
9	文件系统中，常用的文件操作命令有哪些？打开和关闭文件命令的目的是什么?它们的具体功能是什么?
创建(Create)文件  主要功能：在指定设备上为指定路径名的文件建立一个目录项，并设置文件的有关属性。
删除(Delete)文件  主要功能：根据文件的路径名找到指定的目录项，回收其占用的各个物理块，再将该目录项置为空。
打开(Open)文件    根据文件路径名找到目录项，将文件的目录项复制到主存一个专门区域，返回文件在该区域的索引。建立进程与文件的联系。  目的：避免多次重复地检索文件目录。  系统维护了一个系统当前打开文件表。当读/写文件时，通过这个表的索引找到文件的主存目录项。不需要重复地对磁盘进行检索。
关闭(Close)文件  释放文件在主存专门区域中的目录项，切断用户与文件的联系。若该目录项被修改过，则复制到磁盘。若文件作过某些修改，应将其写回辅存。
读(Read)文件     命令中必须指出要读的数据个数，以及存放数据的主存地址。根据文件所在设备、文件类型的不同，系统设置不同的读命令。
写(Write)文件    命令中必须指出要写的数据个数，以及存放数据的主存地址，将主存中的数据写到指定的文件中。
追加(Append)文件 限制了写文件的形式，将数据追加到文件尾。随机存取(Seek)文件 重新定位文件的读/写位置指针。
得到文件属性(Get Attributes)   进程在执行时常常需要了解文件的属性。在UNIX系统中，一个软件开发项目通常由多个源文件组成，make程序用来管理这些软件开发项目。当make被调用时，它检查所有源文件和目标文件的修改时间，并且编排出需要重新编译的文件数。
设置文件属性(Set Attributes)  修改文件的一些属性，以适应用户的要求。
重命名(Rename)文件  重新命名一个已经存在的文件。
10	常用的文件存取控制方法：保护域和存取控制表ACL
一个域（用户、进程、过程）是一组（对象、存取权限）偶对。即给出它能操作的对象和对每个对象的存取权限。
文件的存取控制信息，规定各类用户对文件的存取权限。防止核准的用户误用文件和为核准的用户存取文件。
为存取控制矩阵中的每一列建立一张存取控制表(ACL)，用一有序对(域, 权集)表示。，文件的ACL记录在FCB中
11	理解存储器映射文件。
将文件映射到进程地址空间的一个区域，返回虚拟地址，仅当需要对文件存取时，才传输实际的数据。
12	文件共享与保护：
文件共享：允许多个用户共同使用同一文件。硬链接，符号链接文件（类Unix）MS-DOS和Windows绕道法
文件保护：防止自然灾害导致数据丢失，防止文件被无权使用的用户窃取。
（1）文件复制
（2）增设防护措施（防止病毒程序破坏文件。用户的鉴别----口令。物理鉴定。使用磁卡、指纹和签名等技术。 对文件进行加密。

13	文件系统的组织结构
 

14	文件的存储介质
FAT文件卷：磁盘低级格式化（厂家完成）；硬盘分区（FDISK命令	）分区格式化（FORMAT命令 制作文件系统）
 硬盘主引导扇区：对每个硬盘，有一个硬盘主引导扇区0面0道1扇区。包括（1、硬盘主引导程序2、硬盘分区表3、引导扇区的有效标志或者分区扇区的结束标志）
 
分区规范：一个硬盘有多个主分区，但最多只有一个扩展分区（可以划分成逻辑分区）
MS的OS最多只让划分一个主分区 一个扩展分区 非DOS分区
 
